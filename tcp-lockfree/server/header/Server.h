#pragma once
#include <iostream>
#include <vector>
#include <thread>
#include <mutex>

// Класс для управления сервером
// Этот класс будет использоваться для управления сервером, включая создание сокета, привязку к порту, прослушивание входящих соединений и принятие клиентов
// В этом классе будет храниться сокет сервера, порт, на котором работает сервер, и флаг для контроля работы сервера
// Методы класса будут включать в себя запуск сервера, остановку сервера, принятие клиентов и обработку каждого клиента в отдельном потоке
// Конструктор будет принимать порт для работы сервера и инициализировать его, а также другие переменные
// Деструктор будет закрывать сокет сервера и освобождать ресурсы, связанные с сервером

class Server
{
public:
	Server(int p = 8080);	// конструктор с параметром для порта (по умолчанию 8080)
	~Server();				// деструктор для очистки ресурсов
	void start();			// метод для запуска сервера
	void stop();			// метод для остановки сервера
	void acceptClients();	// метод для принятия клиентов

private:
	int serverSocket;		// сокет сервера
	int clientSocket;		// сокет для клиента (можно использовать для каждого клиента в отдельном потоке)
	int port;				// порт, на котором работает сервер
	bool isRunning;			// флаг для контроля работы сервера

	// Вспомогательные методы для управления серверным сокетом
	bool createServerSocket();				// метод для создания серверного сокета	
	bool bindServerSocket();				// метод для привязки серверного сокета к порту
	bool listenForClients();				// метод для начала прослушивания входящих соединений
	void handleClient(int clientSocket);	// метод для обработки клиента (может быть запущен в отдельном потоке)
	
	std::vector<std::thread> clientThreads; // хранит потоки для каждого клиента
	std::mutex clientThreadsMutex;			// для синхронизации доступа к вектору clientThreads
};